<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Round Edge Square Image Cutter</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(120deg, #f6d365, #fda085);
        margin: 0;
        padding: 0;
        text-align: center;
        color: #333;
        min-height: 100vh;
    }
    h1 {
        margin-top: 30px;
        color: #fff;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    #top-ad, #bottom-ad {
        width: 90%;
        max-width: 728px;
        height: 90px;
        margin: 15px auto;
        background: #fff;
        border: 2px dashed #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #888;
        font-weight: bold;
        font-size: 18px;
    }
    #drop-area {
        border: 2px dashed #fff;
        border-radius: 15px;
        padding: 40px;
        background: rgba(255,255,255,0.2);
        margin: 20px auto;
        width: 90%;
        max-width: 500px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    #drop-area.hover {
        background: rgba(255,255,255,0.4);
        border-color: #fff;
    }
    button {
        margin: 10px 5px;
        padding: 10px 25px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background: #fff;
        color: #f76c6c;
        font-weight: bold;
        transition: all 0.3s ease;
    }
    button:hover {
        background: #f76c6c;
        color: #fff;
    }
    input[type="range"] {
        width: 200px;
        margin: 10px;
    }
    #canvas-container {
        margin-top: 20px;
    }
    canvas {
        max-width: 90%;
        border: 3px solid #fff;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }
    label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
        color: #fff;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    #sliders {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 10px;
    }
    .slider-group {
        margin: 10px;
        background: rgba(255,255,255,0.2);
        padding: 10px 20px;
        border-radius: 10px;
    }
    #filename-option {
        margin: 15px auto;
        background: rgba(255,255,255,0.2);
        padding: 10px 20px;
        border-radius: 10px;
        display: inline-block;
    }
    #filename-option label {
        display: inline-flex;
        align-items: center;
        cursor: pointer;
    }
    #keep-filename {
        margin-right: 8px;
        width: 18px;
        height: 18px;
    }
</style>
</head>
<body>

<h1>Round Edge Square Image Cutter</h1>

<!-- Top Ad -->
<div id="top-ad">Top Banner Ad Placeholder</div>

<div id="drop-area">
    Drag & Drop Image Here<br>or<br>
    <button onclick="document.getElementById('fileInput').click()">Select from File/Gallery</button>
    <input type="file" id="fileInput" accept="image/*">
</div>

<div id="sliders">
    <div class="slider-group">
        <label>Main Level (1–10): <span id="mainValue">1</span></label>
        <input type="range" id="mainSlider" min="1" max="10" value="1">
    </div>
    <div class="slider-group">
        <label>Sub Level (1–200): <span id="subValue">1</span></label>
        <input type="range" id="subSlider" min="1" max="200" value="1">
    </div>
</div>

<div id="filename-option">
    <label for="keep-filename">
        <input type="checkbox" id="keep-filename" checked>
        Keep original filename
    </label>
</div>

<div id="canvas-container">
    <canvas id="canvas"></canvas>
</div>

<div>
    <button id="downloadBtn">Download Original Format</button>
    <button id="downloadPNGBtn">Download as PNG</button>
</div>

<!-- Bottom Ad -->
<div id="bottom-ad">Bottom Banner Ad Placeholder</div>

<script>
const dropArea = document.getElementById('drop-area');
const fileInput = document.getElementById('fileInput');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const mainSlider = document.getElementById('mainSlider');
const subSlider = document.getElementById('subSlider');
const mainValue = document.getElementById('mainValue');
const subValue = document.getElementById('subValue');
const keepFilenameCheckbox = document.getElementById('keep-filename');

let img = new Image();
let originalFormat = 'png';
let originalFilename = '';

function drawImage(mainLevel, subLevel) {
    if (!img.src) return;
    canvas.width = img.width;
    canvas.height = img.height;

    const minSide = Math.min(canvas.width, canvas.height);
    const radius = (mainLevel * subLevel / 2000) * (minSide / 2);

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.beginPath();

    ctx.moveTo(radius, 0);
    ctx.lineTo(canvas.width - radius, 0);
    ctx.quadraticCurveTo(canvas.width, 0, canvas.width, radius);

    ctx.lineTo(canvas.width, canvas.height - radius);
    ctx.quadraticCurveTo(canvas.width, canvas.height, canvas.width - radius, canvas.height);

    ctx.lineTo(radius, canvas.height);
    ctx.quadraticCurveTo(0, canvas.height, 0, canvas.height - radius);

    ctx.lineTo(0, radius);
    ctx.quadraticCurveTo(0, 0, radius, 0);

    ctx.closePath();
    ctx.clip();
    ctx.drawImage(img, 0, 0);
    ctx.restore();
}

function handleFile(file) {
    const reader = new FileReader();
    reader.onload = function(e) {
        img = new Image();
        img.onload = () => {
            originalFormat = file.type.split('/')[1];
            // Extract original filename without extension
            originalFilename = file.name.substring(0, file.name.lastIndexOf('.'));
            drawImage(parseInt(mainSlider.value), parseInt(subSlider.value));
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}

dropArea.addEventListener('dragover', e => { e.preventDefault(); dropArea.classList.add('hover'); });
dropArea.addEventListener('dragleave', e => { dropArea.classList.remove('hover'); });
dropArea.addEventListener('drop', e => {
    e.preventDefault();
    dropArea.classList.remove('hover');
    if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
});

fileInput.addEventListener('change', e => { if (fileInput.files.length) handleFile(fileInput.files[0]); });

mainSlider.addEventListener('input', () => {
    mainValue.textContent = mainSlider.value;
    drawImage(parseInt(mainSlider.value), parseInt(subSlider.value));
});
subSlider.addEventListener('input', () => {
    subValue.textContent = subSlider.value;
    drawImage(parseInt(mainSlider.value), parseInt(subSlider.value));
});

// Function to refresh the page after download
function refreshAfterDownload() {
    setTimeout(() => {
        location.reload();
    }, 1000); // Refresh after 1 second to ensure download has started
}

document.getElementById('downloadBtn').addEventListener('click', () => {
    if (!img.src) return;
    const link = document.createElement('a');
    
    // Determine filename based on checkbox state
    let downloadFilename;
    if (keepFilenameCheckbox.checked && originalFilename) {
        downloadFilename = `${originalFilename}-rounded.${originalFormat}`;
    } else {
        downloadFilename = `rounded-image.${originalFormat}`;
    }
    
    link.download = downloadFilename;
    link.href = canvas.toDataURL(`image/${originalFormat}`);
    link.click();
    refreshAfterDownload();
});

document.getElementById('downloadPNGBtn').addEventListener('click', () => {
    if (!img.src) return;
    const link = document.createElement('a');
    
    // Determine filename based on checkbox state
    let downloadFilename;
    if (keepFilenameCheckbox.checked && originalFilename) {
        downloadFilename = `${originalFilename}-rounded.png`;
    } else {
        downloadFilename = 'rounded-image.png';
    }
    
    link.download = downloadFilename;
    link.href = canvas.toDataURL('image/png');
    link.click();
    refreshAfterDownload();
});
</script>

</body>
</html>